<div class="container my-5">
  <!-- Navigation Between Admin Pages -->
  <nav class="mb-4">
    <div class="nav nav-tabs" id="nav-tab" role="tablist">
      <a class="nav-link active" routerLink="/home/admin">üö™ –î–≤–µ—Ä–∏</a>
      <a class="nav-link" routerLink="/home/admin/platband">ü™ü –ù–∞–ª–∏—á–Ω–∏–∫–∏</a>
      <a class="nav-link" routerLink="/home/admin/frame">üñºÔ∏è –†–∞–º–∫–∏</a>
      <a class="nav-link" routerLink="/home/admin/extension">‚ûï –î–æ–±–æ—Ä–∫–∏</a>
    </div>
  </nav>

  <!-- Add Door Button -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–≤–µ—Ä—è–º–∏</h2>
    <button class="btn btn-success" (click)="openAddModal()">‚ûï –î–æ–±–∞–≤–∏—Ç—å –¥–≤–µ—Ä—å</button>
  </div>

  <!-- Door Listing -->
  <div class="row g-4 mb-5">
    <div class="col-md-4" *ngFor="let door of doors">
      <div class="card shadow-lg border-0 h-100">
        <!-- The image URL here is built by the backend. Prepend your backend URL if needed. -->
        <img [src]="hello() + door.imageUrl" class="card-img-top" [alt]="door.name" />
        <div class="card-body text-center">
          <h5 class="card-title fw-bold">{{ door.name }}</h5>
          <div class="d-grid gap-2">
            <button class="btn btn-primary" (click)="openEditModal(door)">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
            <button class="btn btn-danger" (click)="deleteDoor(door)">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Edit Door Modal -->
  <ng-template #editDoorModal let-modal>
    <div class="modal-header">
      <h5 class="modal-title">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–≤–µ—Ä—å</h5>
      <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss()"></button>
    </div>
    <div class="modal-body">
      <form [formGroup]="editForm" (ngSubmit)="onSubmit()">
        <div class="mb-3">
          <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ</label>
          <input type="text" class="form-control" formControlName="name" />
        </div>
  
        <div class="form-check mb-3">
          <input type="checkbox" class="form-check-input" formControlName="withMirror" />
          <label class="form-check-label">–°–æ —Å—Ç–µ–∫–ª–æ–º</label>
        </div>
  
        <!-- Current Image Preview -->
        <div class="mb-3" *ngIf="selectedDoor?.imageUrl">
          <label class="form-label">–¢–µ–∫—É—â–µ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ:</label>
          <!-- Prepend the backend URL if needed -->
          <img [src]="hello() + selectedDoor?.imageUrl" alt="Current Image" class="img-fluid" />
        </div>

        <!-- Current Multiple Images Preview -->
        <ng-container *ngIf="selectedDoor && selectedDoor.images && selectedDoor.images.length > 0">
          <div class="mb-3">
            <label class="form-label">–¢–µ–∫—É—â–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:</label>
            <div class="row">
              <div class="col-md-3" *ngFor="let image of selectedDoor.images">
                <img [src]="hello() + image.mediaUrl" alt="Current Image" class="img-fluid mb-2" />
              </div>
            </div>
          </div>
        </ng-container>

        <!-- Current Video Preview -->
        <div class="mb-3" *ngIf="selectedDoor?.videoUrl">
          <label class="form-label">–¢–µ–∫—É—â–µ–µ –≤–∏–¥–µ–æ:</label>
          <video [src]="hello() + selectedDoor?.videoUrl" controls preload="metadata" class="w-100" style="max-height: 300px;">
            Your browser does not support the video tag.
          </video>
        </div>

        <!-- Current Multiple Videos Preview -->
        <ng-container *ngIf="selectedDoor && selectedDoor.videos && selectedDoor.videos.length > 0">
          <div class="mb-3">
            <label class="form-label">–¢–µ–∫—É—â–∏–µ –≤–∏–¥–µ–æ:</label>
            <div class="row">
              <div class="col-md-6" *ngFor="let video of selectedDoor.videos">
                <video [src]="hello() + video.mediaUrl" controls preload="metadata" class="w-100 mb-2" style="max-height: 200px;">
                  Your browser does not support the video tag.
                </video>
              </div>
            </div>
          </div>
        </ng-container>
  
        <!-- Multiple Images Upload Section -->
        <div class="mb-3">
          <label class="form-label">–ó–∞–≥—Ä—É–∑–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π</label>
          <input type="file" #multipleImageInput class="form-control" accept="image/*" multiple />
        </div>

        <!-- Multiple Videos Upload Section -->
        <div class="mb-3">
          <label class="form-label">–ó–∞–≥—Ä—É–∑–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∏–¥–µ–æ</label>
          <input type="file" #multipleVideoInput class="form-control" accept="video/*" multiple />
        </div>
  
        <!-- Variants Editing Section -->
        <div formArrayName="variants" class="mb-3">
          <h6>–í–∞—Ä–∏–∞–Ω—Ç—ã –¥–≤–µ—Ä–∏ (—Ä–∞–∑–º–µ—Ä—ã –∏ —Ü–µ–Ω–∞):</h6>
          <div *ngFor="let variant of variants.controls; let i = index" [formGroupName]="i" class="border p-3 mb-2">
            <div class="row">
              <div class="col-md-3">
                <label class="form-label">–í—ã—Å–æ—Ç–∞</label>
                <input type="number" class="form-control" formControlName="height" />
              </div>
              <div class="col-md-3">
                <label class="form-label">–®–∏—Ä–∏–Ω–∞</label>
                <input type="number" class="form-control" formControlName="width" />
              </div>
              <div class="col-md-3">
                <label class="form-label">–¶–µ–Ω–∞</label>
                <input type="number" class="form-control" formControlName="price" />
              </div>
              <div class="col-md-3 d-flex align-items-end">
                <button type="button" class="btn btn-danger w-100" (click)="removeVariant(i)">–£–¥–∞–ª–∏—Ç—å</button>
              </div>
            </div>
          </div>
          <button type="button" class="btn btn-secondary mt-2" (click)="addVariant()">–î–æ–±–∞–≤–∏—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç</button>
        </div>
  
        <button type="submit" class="btn btn-success w-100" [disabled]="editForm.invalid">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
      </form>
    </div>
  </ng-template>

  <!-- Add Door Modal -->
  <ng-template #addDoorModal let-modal>
    <div class="modal-header">
      <h5 class="modal-title">–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –¥–≤–µ—Ä—å</h5>
      <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss()"></button>
    </div>
    <div class="modal-body">
      <form [formGroup]="addForm" (ngSubmit)="onAddSubmit()">
        <div class="mb-3">
          <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ</label>
          <input type="text" class="form-control" formControlName="name" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –¥–≤–µ—Ä–∏" />
        </div>
  
        <div class="form-check mb-3">
          <input type="checkbox" class="form-check-input" formControlName="withMirror" />
          <label class="form-check-label">–°–æ —Å—Ç–µ–∫–ª–æ–º</label>
        </div>
  
        <!-- Multiple Images Upload Section -->
        <div class="mb-3">
          <label class="form-label">–ó–∞–≥—Ä—É–∑–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π</label>
          <input type="file" #addMultipleImageInput class="form-control" accept="image/*" multiple />
        </div>

        <!-- Multiple Videos Upload Section -->
        <div class="mb-3">
          <label class="form-label">–ó–∞–≥—Ä—É–∑–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∏–¥–µ–æ</label>
          <input type="file" #addMultipleVideoInput class="form-control" accept="video/*" multiple />
        </div>
  
        <!-- Variants Adding Section -->
        <div formArrayName="variants" class="mb-3">
          <h6>–í–∞—Ä–∏–∞–Ω—Ç—ã –¥–≤–µ—Ä–∏ (—Ä–∞–∑–º–µ—Ä—ã –∏ —Ü–µ–Ω–∞):</h6>
          <div *ngFor="let variant of addVariants.controls; let i = index" [formGroupName]="i" class="border p-3 mb-2">
            <div class="row">
              <div class="col-md-3">
                <label class="form-label">–í—ã—Å–æ—Ç–∞</label>
                <input type="number" class="form-control" formControlName="height" placeholder="—Å–º" />
              </div>
              <div class="col-md-3">
                <label class="form-label">–®–∏—Ä–∏–Ω–∞</label>
                <input type="number" class="form-control" formControlName="width" placeholder="—Å–º" />
              </div>
              <div class="col-md-3">
                <label class="form-label">–¶–µ–Ω–∞</label>
                <input type="number" class="form-control" formControlName="price" placeholder="—Ä—É–±" />
              </div>
              <div class="col-md-3 d-flex align-items-end">
                <button type="button" class="btn btn-danger w-100" (click)="removeVariantFromAddForm(i)">–£–¥–∞–ª–∏—Ç—å</button>
              </div>
            </div>
          </div>
          <button type="button" class="btn btn-secondary mt-2" (click)="addVariantToAddForm()">–î–æ–±–∞–≤–∏—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç</button>
        </div>
  
        <button type="submit" class="btn btn-success w-100" [disabled]="addForm.invalid">–î–æ–±–∞–≤–∏—Ç—å –¥–≤–µ—Ä—å</button>
      </form>
    </div>
  </ng-template>
</div>
